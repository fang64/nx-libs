XCOMM $XFree86: xc/lib/GL/GL/Imakefile,v 1.23 2003/11/17 03:10:41 dawes Exp $

#include <Threads.tmpl>

#define DoNormalLib NormalLibGlx
#define DoSharedLib SharedLibGlx
#define DoExtraLib SharedLibGlx
#define DoDebugLib DebugLibGlx
#define DoProfileLib ProfileLibGlx

#ifndef ShLibBindGlobals
#if !HasGcc2 || (GccMajorVersion > 2) || (GccMinorVersion > 7)
#define ShlibBindGlobals YES
#endif
#endif

     LIBNAME = GL
     SOREV   = $(SOGLREV)

#ifdef SharedGLReqs
BASEREQUIREDLIBS = SharedGLReqs
#endif

#include "../mesa/array_cache/Imakefile.inc"
#include "../mesa/math/Imakefile.inc"
#include "../mesa/swrast/Imakefile.inc"
#include "../mesa/swrast_setup/Imakefile.inc"
#include "../mesa/tnl/Imakefile.inc"
#include "../mesa/tnl_dd/Imakefile.inc"
#include "../mesa/Imakefile.inc"
#ifdef i386Architecture
#include "../mesa/x86/Imakefile.inc"
#endif
#ifdef SparcArchitecture
#include "../mesa/sparc/Imakefile.inc"
#endif


      GLXOBJS = $(GLXLIBSRC)/glx/?*.o
     GLXUOBJS = $(GLXLIBSRC)/glx/unshared/?*.o $(GLAPI_OBJ)
     GLXDOBJS = $(GLXLIBSRC)/glx/debugger/?*.o $(GLAPI_OBJ)
     GLXPOBJS = $(GLXLIBSRC)/glx/profiled/?*.o $(GLAPI_OBJ)

if GlxBuiltInXMesa

#include "../mesa/drivers/x11/Imakefile.inc"

     DRVOBJS = $(MESAOBJS) $(XMESA_OBJS)
    DRVUOBJS = $(MESAUOBJS) $(XMESA_UOBJS)
    DRVDOBJS = $(MESADOBJS) $(XMESA_DOBJS)
    DRVPOBJS = $(MESAPOBJS) $(XMESA_POBJS)

#else

XCOMM No built-in drivers. This is the usual case.

#endif

REQUIREDLIBS = $(OTHERREQUIREDLIBS) $(VMODEREQUIREDLIBS) $(BASEREQUIREDLIBS)

        OBJS = $(GLXOBJS) $(DRVOBJS)
#if HasSharedLibraries && !SharedLibGlxWithoutPIC
       UOBJS = $(GLXUOBJS) $(DRVUOBJS)
#else
       UOBJS = $(OBJS)
#endif
       DOBJS = $(GLXDOBJS) $(DRVDOBJS)
       POBJS = $(GLXPOBJS) $(DRVPOBJS)

#if LocalThreads
  THREADOBJS = $(THREADS_LIBS)
#endif

#include <Library.tmpl>

#undef _LinkBuildLibrary
#define _LinkBuildLibrary(lib) LinkBuildLibrary(lib)


#if NormalLibGlx
NormalLibraryTarget($(LIBNAME),$(UOBJS))
InstallLibrary($(LIBNAME),$(USRLIBDIR))
#endif
#if SharedLibGlx
SharedDepLibraryTarget($(LIBNAME),$(SOREV),$(OBJS),$(OBJS) $(THREADOBJS),.,.)
InstallSharedLibrary($(LIBNAME),$(SOREV),$(SHLIBDIR))
#if LinkGLToUsrLib && AlternateUsrLibDir
install::
	MakeDir($(DESTDIR)$(SYSTEMUSRLIBDIR))
	$(RM) $(DESTDIR)$(SYSTEMUSRLIBDIR)/lib$(LIBNAME).so
	$(LN) $(SHLIBDIR)/lib$(LIBNAME).so $(DESTDIR)$(SYSTEMUSRLIBDIR)/lib$(LIBNAME).so || true
	$(RM) $(DESTDIR)$(SYSTEMUSRLIBDIR)/lib$(LIBNAME).so.1
	$(LN) $(SHLIBDIR)/lib$(LIBNAME).so.1 $(DESTDIR)$(SYSTEMUSRLIBDIR)/lib$(LIBNAME).so.1 || true
#endif
#endif
#if DebugLibGlx
DebuggedLibraryTarget($(LIBNAME),$(DOBJS))
InstallLibrary($(LIBNAME)_d,$(USRLIBDIR))
#endif
#if ProfileLibGlx
ProfiledLibraryTarget($(LIBNAME),$(POBJS))
InstallLibrary($(LIBNAME)_p,$(USRLIBDIR))
#endif


